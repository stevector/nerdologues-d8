# https://circleci.com/docs/configuration#machine
machine:
  php:
    # https://circleci.com/docs/environment#php
    version: 5.5.11
  environment:
    DOCROOT: "$HOME/$CIRCLE_PROJECT_REPONAME/web"
    SERVER: server.local
    WEB_USER: $(whoami)
    WEB_GROUP: www-data
    TERMINUS_ENV: ci-$CIRCLE_BUILD_NUM
    TERMINUS_SITE: nerdologues-d8
    PATH: $PATH:~/.composer/vendor/bin
  hosts:
    server.local: 127.0.0.1

dependencies:
  cache_directories:
    - ~/.composer/cache
    - ~/nerdologues-d8/node_modules
  pre:
    - ./scripts/circle-ci/php-setup.sh

    # Add apache config.
    - ./scripts/circle-ci/prepare-drupal-server.sh
    - ./scripts/circle-ci/install-globals.sh

test:
  pre:
   - drush --yes --root=$DOCROOT site-install config_installer
  override:
    - composer circle-tests

  post:
    - ./scripts/circle-ci/deploy-to-multidev.sh
    - ./scripts/run-backstop.sh
